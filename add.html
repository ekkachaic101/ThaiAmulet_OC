
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: sans-serif; background-color: #fffaf0; }
    .container { max-width: 1000px; margin: auto; padding: 20px; }
    form { background-color: #fff8dc; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; }
    button { margin-top: 15px; padding: 10px 20px; background-color: #f0c040; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
    button:hover { background-color: #e0b030; }
    .preview { margin-top: 10px; max-width: 150px; border-radius: 6px; border: 1px solid #aaa; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    table { width: 100%; border-collapse: collapse; margin-top: 30px; background-color: #fff8dc; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #f0e68c; }
    img.table-img { width: 80px; height: auto; border-radius: 6px; border: 1px solid #aaa; box-shadow: 0 2px 4px rgba(0,0,0,0.2); object-fit: cover; }
  </style>
</head>
<body>
  <div class="container">
    <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</h2>
    <form id="add-form">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏∞:</label>
      <input type="text" id="name" required>
      <label>‡∏£‡∏≤‡∏Ñ‡∏≤:</label>
      <input type="text" id="price" required>
      <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</label>
      <textarea id="description" rows="4"></textarea>
      <label>‡∏†‡∏≤‡∏û:</label>
      <input type="file" id="image1" accept="image/*">
      <img id="preview1" class="preview">
      <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>

    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß</h3>
    <input type="text" id="search" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏∞" style="width:100%; padding:10px; margin-top:20px;">
    <table>
      <thead>
        <tr>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏∞</th>
          <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
          <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
          <th>‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="amulet-table-body">
        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
      </tbody>
    </table>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabase = createClient(
      'https://srzqmhgdaedfoyakqmpg.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyenFtaGdkYWVkZm95YWtxbXBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3MzU0MTUsImV4cCI6MjA3MjMxMTQxNX0.rs0m4ibkOPvWADs7iLdgDxCLAnwS_Ko6PtHtvyugTsQ'
    );

    async function loadTable() {
      const { data, error } = await supabase
        .from("amulets")
        .select("id, name, price, description, image_url1, image_url2, image_url3, image_url4")
        .order("created_at", { ascending: false });

      if (error) {
        console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        return;
      }

      renderTable(data);
    }

    function renderTable(data) {
      const tableBody = document.getElementById("amulet-table-body");
      tableBody.innerHTML = "";
      data.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td>${item.description || '-'}</td>
          <td>
            ${item.image_url1 ? `<img src="${item.image_url1}" class="table-img">` : ""}
            ${item.image_url2 ? `<img src="${item.image_url2}" class="table-img">` : ""}
            ${item.image_url3 ? `<img src="${item.image_url3}" class="table-img">` : ""}
            ${item.image_url4 ? `<img src="${item.image_url4}" class="table-img">` : ""}
          </td>
          <td>
            <button onclick="editAmulet('${item.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button onclick="deleteAmulet('${item.id}')">üóëÔ∏è ‡∏•‡∏ö</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    document.getElementById("search").addEventListener("input", async (e) => {
      const keyword = e.target.value.toLowerCase();
      const { data, error } = await supabase
        .from("amulets")
        .select("id, name, price, description, image_url1, image_url2, image_url3, image_url4")
        .order("created_at", { ascending: false });

      if (error) return;

      const filtered = data.filter(item =>
        item.name.toLowerCase().includes(keyword)
      );

      renderTable(filtered);
    });

    function editAmulet(id) {
      window.location.href = `edit.html?id=${id}`;
    }

    async function deleteAmulet(id) {
      if (!confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
      const { error } = await supabase.from("amulets").delete().eq("id", id);
      if (error) {
        alert("‚ùå ‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
      } else {
        alert("‚úÖ ‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
        await loadTable();
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await loadTable();
    });
  </script>
</body>
</html>
